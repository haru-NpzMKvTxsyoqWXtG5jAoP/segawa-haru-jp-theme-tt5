<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masonry Fixed Test</title>
    <link rel="stylesheet" href="style.css">
    <style>
        body {
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
        }
        
        .debug-info {
            background: #fff;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
            font-family: monospace;
        }
        
        .debug-info h3 {
            margin-top: 0;
            color: #333;
        }
        
        /* デバッグ用：パディング確認のための背景色 */
        .debug-container {
            background: linear-gradient(90deg, red 0%, red var(--haru-padding-visual), white var(--haru-padding-visual), white calc(100% - var(--haru-padding-visual)), red calc(100% - var(--haru-padding-visual)), red 100%);
            min-height: 30px;
            margin-bottom: 10px;
        }
        
        /* 実際のWordPress CSSから追加設定 */
        .haru-masonry-gallery {
            min-height: 400px;
            background: #fff;
            border: 2px solid #ccc;
        }
        
        /* アイテムのデバッグ表示 */
        .haru-masonry-gallery .haru-masonry-gallery-item {
            border: 1px solid #333;
            background: #e0e0e0;
        }
        
        .haru-masonry-gallery .haru-masonry-gallery-item h3 {
            background: rgba(0, 215, 130, 0.3);
            margin: 0;
            padding: 5px;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="debug-info">
        <h3>Masonry修正版テスト</h3>
        <p><strong>画面幅:</strong> <span id="screen-width"></span>px</p>
        <p><strong>CSS変数値:</strong> <span id="padding-value"></span></p>
        <p><strong>Grid Sizer幅:</strong> <span id="grid-sizer-width"></span></p>
        <p><strong>最初のアイテム幅:</strong> <span id="item-width"></span></p>
        <p><strong>適用メディアクエリ:</strong> <span id="media-query"></span></p>
    </div>
    
    <div class="debug-container"></div>
    
    <div class="haru-masonry-gallery">
        <div class="haru-grid-sizer"></div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/200?random=1" alt="Test 1">
            <h3>テスト画像 1 (通常)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/300?random=2" alt="Test 2">
            <h3>テスト画像 2 (縦長)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/150?random=3" alt="Test 3">
            <h3>テスト画像 3 (横長)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/250?random=4" alt="Test 4">
            <h3>テスト画像 4 (標準)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/180?random=5" alt="Test 5">
            <h3>テスト画像 5 (小さめ)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/320?random=6" alt="Test 6">
            <h3>テスト画像 6 (縦長)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/160?random=7" alt="Test 7">
            <h3>テスト画像 7 (横長)</h3>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/240?random=8" alt="Test 8">
            <h3>テスト画像 8 (標準)</h3>
        </div>
    </div>
    
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
    <script src="js/custom-masonry.js"></script>
    <script>
        function updateDebugInfo() {
            document.getElementById('screen-width').textContent = window.innerWidth;
            
            const paddingValue = getComputedStyle(document.documentElement).getPropertyValue('--haru-padding-visual');
            document.getElementById('padding-value').textContent = paddingValue;
            
            const gridSizer = document.querySelector('.haru-grid-sizer');
            if (gridSizer) {
                const gridWidth = getComputedStyle(gridSizer).width;
                document.getElementById('grid-sizer-width').textContent = gridWidth;
            }
            
            const firstItem = document.querySelector('.haru-masonry-gallery-item');
            if (firstItem) {
                const itemWidth = getComputedStyle(firstItem).width;
                document.getElementById('item-width').textContent = itemWidth;
            }
            
            let mediaQuery = '';
            if (window.matchMedia('(min-width: 1800px)').matches) {
                mediaQuery = '大画面 (1800px+) - 4列表示';
            } else if (window.matchMedia('(min-width: 1131px)').matches) {
                mediaQuery = 'デスクトップ (1131px+) - 3列表示';
            } else if (window.matchMedia('(min-width: 718px)').matches) {
                mediaQuery = 'タブレット (718px+) - 2列表示';
            } else {
                mediaQuery = 'モバイル - 1列表示';
            }
            document.getElementById('media-query').textContent = mediaQuery;
        }
        
        updateDebugInfo();
        window.addEventListener('resize', updateDebugInfo);
        
        // 5秒後に詳細デバッグ情報を表示
        setTimeout(function() {
            console.log('=== 詳細デバッグ情報 ===');
            
            const gridSizer = document.querySelector('.haru-grid-sizer');
            const items = document.querySelectorAll('.haru-masonry-gallery-item');
            
            console.log('Grid sizer computed style:', getComputedStyle(gridSizer));
            console.log('Grid sizer position/size:', {
                offsetLeft: gridSizer.offsetLeft,
                offsetTop: gridSizer.offsetTop,
                offsetWidth: gridSizer.offsetWidth,
                offsetHeight: gridSizer.offsetHeight
            });
            
            items.forEach((item, index) => {
                const style = getComputedStyle(item);
                console.log(`Item ${index + 1}:`, {
                    width: style.width,
                    position: style.position,
                    display: style.display,
                    float: style.float,
                    left: item.style.left,
                    top: item.style.top,
                    offsetLeft: item.offsetLeft,
                    offsetTop: item.offsetTop,
                    offsetWidth: item.offsetWidth,
                    offsetHeight: item.offsetHeight
                });
            });
            
            // Masonryインスタンスの情報
            if (window.masonryInstance) {
                console.log('Masonry instance:', window.masonryInstance);
                console.log('Masonry options:', window.masonryInstance.options);
            }
        }, 5000);
    </script>
</body>
</html>