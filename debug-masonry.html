<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Masonry Debug Test</title>
    <style>
        /* CSS変数定義（style.cssから抜粋） */
        :root {
            --haru-padding-visual: clamp(15px, calc(2.5px + 3.3vw), 50px);
            --gallery-gutter: 4px;
            --card-border-radius: 20px;
            --transition-fast: 0.15s ease-out;
        }
        
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
            background: #f0f0f0;
        }
        
        /* デバッグ用：パディング確認のための背景色 */
        .debug-container {
            background: linear-gradient(90deg, red 0%, red var(--haru-padding-visual), white var(--haru-padding-visual), white calc(100% - var(--haru-padding-visual)), red calc(100% - var(--haru-padding-visual)), red 100%);
            min-height: 50px;
            margin-bottom: 20px;
        }
        
        /* Masonry設定（style.cssから抜粋）*/
        .haru-masonry-gallery {
            display: block !important;
            padding-left: var(--haru-padding-visual) !important;
            padding-right: var(--haru-padding-visual) !important;
            padding-top: 0 !important;
            padding-bottom: 0 !important;
            width: 100% !important;
            margin: 0 !important;
            position: relative !important;
            box-sizing: border-box !important;
            background: #fff;
            min-height: 300px;
        }
        
        .haru-masonry-gallery .haru-grid-sizer {
            width: 100% !important;
            height: 0 !important;
            visibility: hidden !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .haru-masonry-gallery .haru-masonry-gallery-item {
            width: 100% !important;
            margin-bottom: var(--gallery-gutter) !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            margin-top: 0 !important;
            padding: 0 !important;
            background: #e0e0e0 !important;
            border-radius: var(--card-border-radius) !important;
            overflow: hidden !important;
            display: block !important;
            box-sizing: border-box !important;
            position: relative !important;
        }
        
        .haru-masonry-gallery .haru-masonry-gallery-item img {
            width: 100% !important;
            height: auto !important;
            display: block !important;
        }
        
        /* レスポンシブ設定 */
        @media (min-width: 718px) {
            .haru-masonry-gallery .haru-grid-sizer {
                width: 50% !important;
            }
            .haru-masonry-gallery .haru-masonry-gallery-item {
                width: 50% !important;
            }
        }
        
        @media (min-width: 1131px) {
            .haru-masonry-gallery .haru-grid-sizer {
                width: 33.333% !important;
            }
            .haru-masonry-gallery .haru-masonry-gallery-item {
                width: 33.333% !important;
            }
        }
        
        @media (min-width: 1800px) {
            .haru-masonry-gallery .haru-grid-sizer {
                width: 25% !important;
            }
            .haru-masonry-gallery .haru-masonry-gallery-item {
                width: 25% !important;
            }
        }
    </style>
</head>
<body>
    <h1>Masonry Debug Test</h1>
    
    <h2>パディング確認用（赤い部分がパディング領域）:</h2>
    <div class="debug-container"></div>
    
    <h2>現在の画面幅: <span id="screen-width"></span>px</h2>
    <h2>CSS変数値: <span id="padding-value"></span></h2>
    <h2>Grid Sizer幅: <span id="grid-sizer-width"></span></h2>
    <h2>アイテム幅: <span id="item-width"></span></h2>
    <h2>適用メディアクエリ: <span id="media-query"></span></h2>
    
    <div class="haru-masonry-gallery">
        <div class="haru-grid-sizer"></div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/200?random=1" alt="Test 1">
            <div style="padding: 10px;">
                <h3>テスト画像 1</h3>
                <p>説明文テスト</p>
            </div>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/300?random=2" alt="Test 2">
            <div style="padding: 10px;">
                <h3>テスト画像 2</h3>
                <p>縦長画像のテスト</p>
            </div>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/150?random=3" alt="Test 3">
            <div style="padding: 10px;">
                <h3>テスト画像 3</h3>
                <p>横長画像のテスト</p>
            </div>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/250?random=4" alt="Test 4">
            <div style="padding: 10px;">
                <h3>テスト画像 4</h3>
                <p>標準サイズのテスト</p>
            </div>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/180?random=5" alt="Test 5">
            <div style="padding: 10px;">
                <h3>テスト画像 5</h3>
                <p>もう一つのテスト画像</p>
            </div>
        </div>
        
        <div class="haru-masonry-gallery-item">
            <img src="https://picsum.photos/300/320?random=6" alt="Test 6">
            <div style="padding: 10px;">
                <h3>テスト画像 6</h3>
                <p>さらに縦長の画像テスト</p>
            </div>
        </div>
    </div>
    
    <script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
    <script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
    <script>
        // 画面幅表示
        function updateScreenInfo() {
            document.getElementById('screen-width').textContent = window.innerWidth;
            
            // CSS変数の値を取得
            const paddingValue = getComputedStyle(document.documentElement).getPropertyValue('--haru-padding-visual');
            document.getElementById('padding-value').textContent = paddingValue;
            
            // Grid Sizerの幅を確認
            const gridSizer = document.querySelector('.haru-grid-sizer');
            if (gridSizer) {
                const gridWidth = getComputedStyle(gridSizer).width;
                document.getElementById('grid-sizer-width').textContent = gridWidth;
            }
            
            // アイテムの幅を確認
            const firstItem = document.querySelector('.haru-masonry-gallery-item');
            if (firstItem) {
                const itemWidth = getComputedStyle(firstItem).width;
                document.getElementById('item-width').textContent = itemWidth;
            }
            
            // 適用されているメディアクエリを確認
            let mediaQuery = '';
            if (window.matchMedia('(min-width: 1131px)').matches) {
                mediaQuery = 'デスクトップ (1131px+) - 3列表示';
            } else if (window.matchMedia('(min-width: 718px)').matches) {
                mediaQuery = 'タブレット (718px+) - 2列表示';
            } else {
                mediaQuery = 'モバイル - 1列表示';
            }
            document.getElementById('media-query').textContent = mediaQuery;
        }
        
        updateScreenInfo();
        window.addEventListener('resize', updateScreenInfo);
        
        // Masonry初期化
        const elem = document.querySelector('.haru-masonry-gallery');
        
        imagesLoaded(elem, function() {
            console.log('画像読み込み完了、Masonry初期化開始');
            
            // 少し遅延してMasonryを初期化（CSSが完全に適用されるまで待つ）
            setTimeout(function() {
                const msnry = new Masonry(elem, {
                    itemSelector: '.haru-masonry-gallery-item',
                    columnWidth: '.haru-grid-sizer',
                    gutter: 0,
                    percentPosition: true,
                    transitionDuration: 0
                });
                
                console.log('Masonry初期化完了:', msnry);
                
                // 初期化直後に強制レイアウト更新
                setTimeout(function() {
                    console.log('強制レイアウト更新');
                    msnry.layout();
                    updateScreenInfo();
                }, 100);
                
                // リサイズ時の再レイアウト
                window.addEventListener('resize', function() {
                    clearTimeout(window.resizeTimer);
                    window.resizeTimer = setTimeout(function() {
                        console.log('リサイズ検出、レイアウト更新');
                        msnry.layout();
                        updateScreenInfo();
                    }, 250);
                });
            }, 100);
        });
    </script>
</body>
</html>